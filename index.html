<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📸 收据识别测试</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ========================================== -->
    <!-- 📤 上传页面 -->
    <!-- ========================================== -->
    <div id="uploadPage" class="container">
        <h1>📸 收据识别测试</h1>
        
        <div class="input-group">
            <label>Web App URL:</label>
            <input type="text" id="apiUrl" placeholder="https://script.google.com/macros/s/.../exec">
        </div>
        
        <div class="input-group">
            <label>Token:</label>
            <input type="text" id="token" value="test123">
        </div>
        
        <div class="input-group">
            <label>选择收据照片:</label>
            <div class="button-group">
                <button type="button" class="btn-secondary" onclick="ImageHandler.selectFromGallery()">📁 从相册选择</button>
                <button type="button" class="btn-secondary" onclick="ImageHandler.takePhoto()">📸 拍照</button>
            </div>
            <input type="file" id="galleryFile" accept="image/jpeg,image/jpg,image/png" style="display: none;">
            <input type="file" id="cameraFile" accept="image/jpeg,image/jpg,image/png" capture="environment" style="display: none;">
            <div id="imagePreview"></div>
            <p class="hint">⚠️ 仅支持 JPG/PNG 格式（不支持 HEIC）</p>
        </div>
        
        <button class="btn" onclick="UploadHandler.uploadReceipt()" id="uploadBtn" disabled>🚀 开始识别</button>
        
        <div id="result"></div>
    </div>

    <!-- ========================================== -->
    <!-- ✅ 确认页面 -->
    <!-- ========================================== -->
    <div id="confirmPage" class="container" style="display: none;">
        <h1>✅ 识别结果确认</h1>
        
        <form id="confirmForm" onsubmit="return false;">
            <div class="input-group">
                <label>📅 日期:</label>
                <input type="date" id="confirmDate" class="form-input" required>
            </div>
            
            <div class="input-group">
                <label>💰 金额 (円):</label>
                <input type="number" id="confirmAmount" class="form-input" min="0" step="1" required>
            </div>
            
            <div class="input-group">
                <label>🏪 店名:</label>
                <input type="text" id="confirmStore" class="form-input" maxlength="50" required>
            </div>
            
            <div class="input-group">
                <label>📊 税率:</label>
                <select id="confirmTaxRate" class="form-input">
                    <option value="10%">10% (標準税率)</option>
                    <option value="8%">8% (軽減税率)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>🔢 T番号:</label>
                <input type="text" 
                       id="confirmHasTNumber" 
                       class="form-input" 
                       placeholder="T1234567890123 (留空表示无)"
                       pattern="T\d{13}|^$"
                       maxlength="14"
                       title="格式：T + 13位数字，例如 T1234567890123">
                <p class="hint">📌 格式：T + 13位数字（例如 T1234567890123），无番号则留空</p>
            </div>
            
            <div class="input-group">
                <label>📈 置信度:</label>
                <div class="confidence-badge" id="confirmConfidence">
                    85%
                </div>
            </div>
        </form>
        
        <div class="button-group">
            <button type="button" class="btn-secondary" onclick="PageSwitcher.showUploadPage()">
                ⬅️ 返回
            </button>
            <button type="button" class="btn" onclick="ConfirmHandler.submitToSheet()">
                ✅ 提交到 Sheet
            </button>
        </div>
        
        <div id="confirmResult"></div>
    </div>

    <!-- ========================================== -->
    <!-- 📦 模块化脚本加载 -->
    <!-- ========================================== -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="image-handler.js"></script>
    <script src="page-switcher.js"></script>
    <script src="confirm-handler.js"></script>
    <script src="upload-handler.js"></script>
</body>
</html>